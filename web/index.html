<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Semantic Synchrony</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Semantic Synchrony</h1>
        <span id="connection-status">Disconnected</span>
        <div id="source-legend"></div>
        <button class="toolbar-btn" id="btn-split" onclick="toggleSplit()" title="Toggle split view (C-x 3)"><svg width="16" height="16" viewBox="0 0 32 32" fill="currentColor"><rect x="15" y="4" width="2" height="24"/><path d="M10,7V25H4V7h6m0-2H4A2,2,0,0,0,2,7V25a2,2,0,0,0,2,2h6a2,2,0,0,0,2-2V7a2,2,0,0,0-2-2Z"/><path d="M28,7V25H22V7h6m0-2H22a2,2,0,0,0-2,2V25a2,2,0,0,0,2,2h6a2,2,0,0,0,2-2V7a2,2,0,0,0-2-2Z"/></svg></button>
        <a href="#" onclick="toggleHelp(); return false;" style="color: #0066cc; text-decoration: none; font-size: 13px;" title="Help (?)">Help</a>
    </header>

    <div id="panes-container">
        <div class="pane-wrapper active-pane" id="pane-wrapper-0" onclick="setActivePane(0)">
            <div class="pane-search">
                <input type="text" class="search-input" id="search-input-0" placeholder="Search... (press / to focus)" />
            </div>
            <div class="pane-toolbar">
                <div class="toolbar-group">
                    <button class="toolbar-btn" id="btn-back-0" onclick="popView()" title="Go back (Backspace)">&#9664;</button>
                    <button class="toolbar-btn" id="btn-forward-0" onclick="forwardView()" title="Go forward">&#9654;</button>
                </div>
                <div class="toolbar-separator"></div>
                <div class="toolbar-group">
                    <span class="toolbar-label">View:</span>
                    <button class="toolbar-btn active" id="btn-forward-view-0" onclick="setViewStyle('forward')" title="Forward view (children)">&#9660;</button>
                    <button class="toolbar-btn" id="btn-backward-view-0" onclick="setViewStyle('backward')" title="Backward view (parents)">&#9650;</button>
                </div>
                <div class="toolbar-separator"></div>
                <div class="toolbar-group">
                    <span class="toolbar-label">Depth:</span>
                    <select id="depth-select-0" class="depth-select" onchange="setViewDepth(0, this.value); this.blur();">
                        <option value="1">1</option>
                        <option value="2" selected>2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                </div>
                <div class="toolbar-separator"></div>
                <div class="toolbar-group">
                    <button class="toolbar-btn" id="btn-refresh-0" onclick="refreshView()" title="Refresh (r)">&#8635;</button>
                </div>
            </div>
            <main id="tree-container-0" class="pane-content" tabindex="0">
                <div class="loading">Connecting to server...</div>
            </main>
        </div>
        <div id="pane-divider"></div>
        <div class="pane-wrapper" id="pane-wrapper-1" onclick="setActivePane(1)">
            <div class="pane-search">
                <input type="text" class="search-input" id="search-input-1" placeholder="Search... (press / to focus)" />
            </div>
            <div class="pane-toolbar">
                <div class="toolbar-group">
                    <button class="toolbar-btn" id="btn-back-1" onclick="popViewPane(1)" title="Go back">&#9664;</button>
                    <button class="toolbar-btn" id="btn-forward-1" onclick="forwardViewPane(1)" title="Go forward">&#9654;</button>
                </div>
                <div class="toolbar-separator"></div>
                <div class="toolbar-group">
                    <span class="toolbar-label">View:</span>
                    <button class="toolbar-btn active" id="btn-forward-view-1" onclick="setViewStylePane('forward', 1)" title="Forward view (children)">&#9660;</button>
                    <button class="toolbar-btn" id="btn-backward-view-1" onclick="setViewStylePane('backward', 1)" title="Backward view (parents)">&#9650;</button>
                </div>
                <div class="toolbar-separator"></div>
                <div class="toolbar-group">
                    <span class="toolbar-label">Depth:</span>
                    <select id="depth-select-1" class="depth-select" onchange="setViewDepth(1, this.value); this.blur();">
                        <option value="1">1</option>
                        <option value="2" selected>2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                    </select>
                </div>
                <div class="toolbar-separator"></div>
                <div class="toolbar-group">
                    <button class="toolbar-btn" id="btn-refresh-1" onclick="refreshViewPane(1)" title="Refresh">&#8635;</button>
                </div>
            </div>
            <main id="tree-container-1" class="pane-content" tabindex="0">
                <div class="loading">Click to activate</div>
            </main>
        </div>
    </div>

    <footer>
        <span id="status-message">Press ? for help</span>
        <span id="node-count"></span>
    </footer>

    <!-- Help overlay -->
    <div id="help-overlay" class="overlay">
        <div class="overlay-content" style="max-width: 700px; max-height: 85vh; overflow-y: auto;">
            <h2>Semantic Synchrony Web UI</h2>
            <p style="margin-bottom: 16px; color: var(--muted-color);">
                A browser-based frontend for viewing and editing your knowledge graph.
                <a href="https://github.com/synchrony/smsn" target="_blank" style="color: #0066cc;">GitHub Project</a>
            </p>

            <h3 style="color: #0066cc; margin-top: 16px; margin-bottom: 8px;">Quick Keys</h3>
            <div style="display: flex; gap: 32px;">
                <div>
                    <table>
                        <tr><td colspan="2" style="color: var(--muted-color); padding-top: 8px;">Navigation</td></tr>
                        <tr><td>Enter</td><td>Push view (focus note)</td></tr>
                        <tr><td>Backspace</td><td>Pop view (go back)</td></tr>
                        <tr><td>&#8593;&#8595; or j/k</td><td>Move selection up/down</td></tr>
                        <tr><td>&#8592;&#8594; or h/l</td><td>Collapse / expand</td></tr>
                        <tr><td>/</td><td>Focus search</td></tr>
                        <tr><td>r</td><td>Refresh view</td></tr>
                        <tr><td>g</td><td>Go to alias or URL</td></tr>
                        <tr><td>Tab</td><td>Switch pane (in split view)</td></tr>
                    </table>
                </div>
                <div>
                    <table>
                        <tr><td colspan="2" style="color: var(--muted-color); padding-top: 8px;">Editing</td></tr>
                        <tr><td>e</td><td>Edit title inline</td></tr>
                        <tr><td>n / N</td><td>New child / sibling note</td></tr>
                        <tr><td>p</td><td>Edit properties</td></tr>
                        <tr><td>d</td><td>Remove from parent</td></tr>
                        <tr><td>C-w</td><td>Cut note</td></tr>
                        <tr><td>M-w</td><td>Copy note</td></tr>
                        <tr><td>C-y</td><td>Paste as child</td></tr>
                        <tr><td>C-S-y</td><td>Paste as sibling</td></tr>
                        <tr><td>M-&#8593; / M-&#8595;</td><td>Move note up/down</td></tr>
                        <tr><td>C-/</td><td>Undo</td></tr>
                        <tr><td>?</td><td>Toggle this help</td></tr>
                    </table>
                </div>
            </div>

            <h3 style="color: #0066cc; margin-top: 20px; margin-bottom: 8px;">Emacs-style Chords</h3>
            <div style="display: flex; gap: 32px;">
                <div>
                    <table>
                        <tr><td colspan="2" style="color: var(--muted-color); padding-top: 8px;">C-c prefix</td></tr>
                        <tr><td>C-c t</td><td>Push view (focus note)</td></tr>
                        <tr><td>C-c h</td><td>Pop view (history back)</td></tr>
                        <tr><td>C-c b / f</td><td>Backward / forward view</td></tr>
                        <tr><td>C-c s</td><td>Search (focus input)</td></tr>
                        <tr><td>C-c u</td><td>Update/refresh view</td></tr>
                        <tr><td>C-c n</td><td>New child note</td></tr>
                        <tr><td>C-c p</td><td>Push view to server</td></tr>
                        <tr><td>C-c d</td><td>Remove from parent</td></tr>
                        <tr><td>C-c x</td><td>Go to shortcut/alias</td></tr>
                        <tr><td>C-c r / v</td><td>Copy reference / title</td></tr>
                        <tr><td>C-c C-d</td><td>Set view depth</td></tr>
                        <tr><td>C-c C-f</td><td>Find roots</td></tr>
                    </table>
                </div>
                <div>
                    <table>
                        <tr><td colspan="2" style="color: var(--muted-color); padding-top: 8px;">C-c C-t (properties)</td></tr>
                        <tr><td>C-c C-t i</td><td>Show property info</td></tr>
                        <tr><td>C-c C-t C-w</td><td>Set weight (0-4)</td></tr>
                        <tr><td>C-c C-t C-s</td><td>Set source</td></tr>
                        <tr><td>C-c C-t C-p</td><td>Set priority (0-4)</td></tr>
                        <tr><td>C-c C-t C-a</td><td>Set alias</td></tr>
                        <tr><td colspan="2" style="color: var(--muted-color); padding-top: 8px;">C-c C-v (view options)</td></tr>
                        <tr><td>C-c C-v o</td><td>Toggle line wrap</td></tr>
                        <tr><td colspan="2" style="color: var(--muted-color); padding-top: 8px;">C-x prefix</td></tr>
                        <tr><td>C-x k</td><td>Kill buffer (pop view)</td></tr>
                        <tr><td>C-x 3</td><td>Split window</td></tr>
                        <tr><td>C-x 1</td><td>Close split</td></tr>
                        <tr><td>C-x o</td><td>Other window</td></tr>
                    </table>
                </div>
            </div>

            <h3 style="color: #0066cc; margin-top: 20px; margin-bottom: 8px;">Tree Icons</h3>
            <table>
                <tr><td style="font-family: monospace;">&#9660;</td><td>Expanded node (children visible)</td></tr>
                <tr><td style="font-family: monospace;">&#9654;</td><td>Collapsed node (has children, can expand)</td></tr>
                <tr><td style="font-family: monospace;">&#9655;</td><td>Has children but beyond view depth (increase depth to see)</td></tr>
                <tr><td style="font-family: monospace;">&#183;</td><td>Leaf node (no children)</td></tr>
            </table>

            <p style="margin-top: 20px; color: var(--muted-color); font-size: 12px;">
                Press <strong>Escape</strong> or <strong>?</strong> to close this help.
                For the full Emacs experience, use <a href="https://github.com/synchrony/smsn-mode" target="_blank" style="color: #0066cc;">smsn-mode</a>.
            </p>
        </div>
    </div>

    <!-- Properties overlay -->
    <div id="properties-overlay" class="overlay">
        <div class="overlay-content">
            <h2>Edit Properties</h2>
            <div class="property-row">
                <label>Title</label>
                <input type="text" id="prop-title" />
            </div>
            <div class="property-row">
                <label>Weight</label>
                <input type="range" id="prop-weight" min="0.1" max="1" step="0.1" />
                <span id="prop-weight-value" style="width: 30px; text-align: right;">0.5</span>
            </div>
            <div class="property-row">
                <label>Priority</label>
                <input type="range" id="prop-priority" min="0" max="1" step="0.1" />
                <span id="prop-priority-value" style="width: 30px; text-align: right;">-</span>
            </div>
            <div class="property-row">
                <label>Source</label>
                <select id="prop-source"></select>
            </div>
            <div class="property-row">
                <label>Alias</label>
                <input type="text" id="prop-alias" placeholder="(e.g. URL)" style="font-family: monospace;" />
            </div>
            <div class="button-row">
                <button onclick="hideProperties()">Cancel</button>
                <button class="primary" onclick="saveProperties()">Save</button>
            </div>
        </div>
    </div>

    <!-- Confirm remove overlay -->
    <div id="confirm-overlay" class="overlay">
        <div class="overlay-content">
            <h2>Confirm Remove</h2>
            <div class="confirm-message" id="confirm-message"></div>
            <div class="button-row">
                <button id="confirm-cancel-btn" onclick="hideConfirm()">Cancel</button>
                <button id="confirm-remove-btn" class="danger" onclick="confirmDelete()">Remove</button>
            </div>
        </div>
    </div>

    <!-- New note overlay -->
    <div id="new-note-overlay" class="overlay">
        <div class="overlay-content">
            <h2 id="new-note-title">New Note</h2>
            <div class="property-row">
                <label>Title</label>
                <input type="text" id="new-note-input" placeholder="Enter note title..." />
            </div>
            <div class="button-row">
                <button onclick="hideNewNote()">Cancel</button>
                <button class="primary" onclick="createNewNote()">Create</button>
            </div>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
